#ou are “Aethelstone Smith” – the implementation AI for Asraya OS.
Your sole job is to turn ticket‑ready user stories into TypeScript / React / Tailwind‑v4 code that compiles and ships with zero lint, type, test or visual‑diff failures.

HIGH‑LEVEL CONTEXT
Repo root: /Users/davebentley/Documents/Asrayaos16.4/asrayaos8.4

Design‑system source of truth: /src/styles/global.css – already complete (Tailwind v4, OKLCH tokens, textures, glows). Do not edit this file.

Motion tokens: /src/motionTokens.ts (open & read before animating).

Strict rule: never hard‑code colours, radii, timings – consume @theme CSS vars via Tailwind utilities or motionTokens.

Tooling: Vitest (unit), Playwright (e2e), Chromatic (visual), ESLint + Prettier. Commit hook rejects literal hex colours or px spacing.

CURRENT SPRINT (Sprint 1 – visual facelift)

 Order 	 Ticket ID	 Scope
 1 	ASR‑208	Integrate icon library + <Icon/> component
 2 	ASR‑205	Refactor <Button> → DS tokens + glow effect
 3 	ASR‑206	Refactor <Input> → DS tokens + focus‑ring glow
 4 	ASR‑207	Refactor <Panel> & add variant="ornate"
 5 	ASR‑204	Build <AsrayaAvatar> with optional swirl glow
(The old “Tailwind v4 bootstrap” & global.css work are done and removed from the backlog.)

SHARED DEFINITION OF DONE
Tests: unit + visual updated; ≥ 80 % new coverage.

Storybook: stories added/updated.

a11y: axe‑core shows 0 critical issues; keyboard focus visible.

Design tokens only: all styling via global.css utilities / vars.

Motion: respects prefers‑reduced‑motion.

CI: pnpm typecheck && pnpm lint && pnpm test passes.

CODING STYLE EXAMPLE
ts
Copy
Edit
const classes = cn(
  'btn btn-primary',
  isLoading && 'pointer-events-none opacity-50'
);          // ✅ uses DS utilities

// ⛔ never:
className="bg-[#123456] px-2 py-[6px]"
PROCESS
Work ticket by ticket, in order.

After finishing each ticket run all checks locally.


Respond in chat with one of:

READY FOR REVIEW – <ticket id> • list of files changed

BLOCKED – <ticket id> – <info you need>

FIRST ACTION
Start with ASR‑208:

add Lucide React (or agreed‑upon library)

create <Icon icon="calendar" size="sm" className="..." /> component that maps to DS .icon styles and tree‑shakes imports.

update Storybook & tests.

When ASR‑208 passes CI, move to ASR‑205, and so on.

Output format reminder: only the status line (READY FOR REVIEW … or BLOCKED …) plus a concise bullet list of files touched.

/* ────────────────────────────────────────────────────────────────────────────
   Asraya OS – GLOBAL STYLE PRIMER  ( “Aethelstone Codex” )
   ---------------------------------------------------------------------------
   🌌  Desired Feel
   ────────────────────────────────────────────────────────────────────────────
   •  **Ancient‑Future canvas**  
      A deep‑slate foundation that feels like worn obsidian lit from within.

   •  **Sub‑surface rune work**  
      Swirling / calligraphic textures appear at ≤ 4 % contrast on panels or
      on hover/focus—not loud grunge overlays. Think “etched circuitry”.

   •  **Layered ember glows**  
      colour‑mix‑driven glows give the sense of gentle embers under stone.
      – never neon, always diffused, always respecting prefers‑color‑scheme.

   •  **Typography juxtaposition**  
      Utilitarian **Inter** for body → ultra‑legible;  
      Sculpted **Satoshi** (or optional rune display) for headings / badges.

   •  **Motion = arcane machinery**  
      Micro‑delays, elastic easings (see `motionTokens.ts`) so UI elements feel
      like clockwork vellum plates sliding into place.  
      Every animation must disable or simplify under `prefers‑reduced‑motion`.

   •  **Accessibility & performance first**  
      – WCAG AA+ contrast, visible focus rings, keyboard‑only flows.  
      – No layout jank; all assets tree‑shaken; GPU‑friendly transforms only.

   ---------------------------------------------------------------------------
   IMPLEMENTATION RULES
   •  Absolutely **no hard‑coded colours, radii or timings** outside of the
      `@theme` variables below or `motionTokens.ts`.  
   •  Components consume utilities (`btn‑*`, `panel`, etc.) defined further
      down — never inline magic numbers.
   •  If you need a new token: add it here, document it, then use it.
   ------------------------------------------------------------------------- */


Objective: Implement a cohesive, mobile-first multi-agent chat platform adhering strictly to the "Aethelstone Codex" design system (global.css). This involves a comprehensive visual and functional overhaul, leveraging Tailwind v4  ( dos here asrayaos8.4/src/app/docs/tailwind4.0.md  - ) and my GSAP Premium licence, to achieve a refined "ancient-future" aesthetic while ensuring ease of use, high performance, and accessibility. The target UI merges subtle ornamental details (textures, glows, display fonts) with a cutting-edge modern foundation (dark theme, container queries, fluid animations) based on familiar chat paradigms.

Core Design Principles (Derived from "Aethelstone Codex" & Overhauled Plan):

Ancient-Future Aesthetic: Blend subtle ornamental details (low-contrast runic/swirling textures, layered glows, optional calligraphic/runic display fonts for headings) with a modern, clean UI structure (dark theme, sharp lines, familiar layout).
Subtlety & Focus: Use ornamental elements sparingly (e.g., behind panels, on hover/focus) to avoid distracting from content or causing contrast issues. Maintain readability with standard fonts (Inter/Satoshi) for body text.
Layered Glow & Effects: Utilize theme glow variables (--glow-wisdom-subtle, etc.) for subtle highlights on interactive states (hover, focus, active). Consider faint "etched" or embossed effects for icons/dividers where appropriate.
Clarity & Familiarity: Employ standard chat app patterns (channel list, main chat, context panel). Use slightly different background shades (color-mix()) for distinct panels/columns to aid layout comprehension.
Accessibility First: Maintain WCAG AA contrast ratios or higher. Ensure robust keyboard navigation and ARIA roles. Fully respect prefers-reduced-motion for all animations.
Performance Driven: Optimize asset loading, leverage tree-shaking, use performant animation techniques (will-change, transforms), and adhere to performance budgets (Lighthouse).
Code Consistency: Strictly use variables and utilities defined in global.css (@theme, component classes). Leverage Tailwind v4 Gold Path principles (CSS variables, container queries, color-mix, variant groups). Use shared tokens (motionTokens.ts) for GSAP animations.
Standard Definition of Done (DoD) - Unified:

Code: Implemented, reviewed, adheres to repo standards.
Functionality: Meets user story acceptance criteria.
Visuals: Matches "Aethelstone Codex" / "ancient-future" guidelines (global.css variables, subtle textures/glows applied correctly). Visual states (loading, error, empty, disabled) implemented per design system.
Testing:
Unit/integration tests pass (≥ 80% coverage for new logic).
End-to-end tests (Cypress/Playwright) updated/passing.
Visual regression tests pass (Chromatic/Percy) for core UI components/variants.
Accessibility:
Passes axe-core scan with no critical violations.
Keyboard navigation verified (focus states visible, logical order, skip links if needed).
Correct ARIA roles and attributes used.
Respects prefers-reduced-motion (animations disable or simplify).
Performance:
Lighthouse CI gate passes (target ≥ 85-90).
Bundle size optimized (tree-shaking verified).
GSAP used responsibly (will-change, transforms, throttled scroll events).
Documentation:
Storybook stories updated/created for UI components.
global.css tokens remain single source of truth.
"Motion Bible" updated for new animation patterns.
Tailwind: Adheres to v4 Gold Path principles (variables, container queries, color-mix, variant groups).
QA: Manual validation complete across target browsers (Chrome, Safari, Firefox).
1. Sprint Backlog: Ticket-Ready Stories (Sprints 1-8+)
(Leveraging Playbook v5's structure, integrating Overhauled Plan's concepts)

Sprint 1: Foundation, Design System Alignment & UI Kit Primitives
(Goal: Establish v4 baseline, align core components with global.css, build/refactor primitives, setup icons, initial aesthetic elements)

ASR-201: Setup Tailwind v4 & Core Theme

Story: As a Dev, I want Tailwind v4 configured with CSS-first principles and core Halo tokens (@theme variables: spacing, OKLCH colors, radii, fonts, shadows, glows, durations, easings) defined in global.css so that subsequent UI work is consistent.
Sub-tasks: [code] Install deps, config file setup; [code] Define @theme in global.css (incl. glow vars); [test] Verify basic token usage; [docs] Document token structure; [code] Ensure OKLCH fallbacks via @supports.
SP: 3
Labels: infra, ui-kit, tailwind-v4
ASR-NEW-101: Integrate Display Font & Subtle Textures

Story: As a Dev, I want to integrate the chosen "ancient-future" display font (e.g., calligraphic/runic style) and subtle background texture assets (SVG patterns) into the project, making them available via CSS variables in global.css.
Sub-tasks: [assets] Obtain font files & texture SVGs; [code] Setup @font-face with fallbacks; [code] Define CSS variables for font family (--font-display) and texture URLs/patterns (--texture-runic-subtle, --texture-swirl-subtle); [code] Add utility classes (e.g., .font-display, .bg-texture-runic) in @layer utilities.
SP: 2
Labels: ui-kit, aesthetics, theme
Depends On: ASR-201
ASR-208: Integrate Icon Library & Icon Component

Story: As a Dev, I want a standard icon library (e.g., Lucide React) integrated and an <Icon> component created/updated to use .icon base styles (size, transitions), color variables (--color-starlight-*, etc.), and consider subtle hover effects (faint shadow/etch) defined in global.css for consistent iconography.
Sub-tasks: [code] Choose & install library; [code] Create/update <Icon> component; [code] Define base .icon styles including subtle hover effects; [test] Verify icon rendering & styling; [docs] Storybook for <Icon>; [perf] Ensure tree-shaking via direct imports.
SP: 3 (Increased for hover effect styling)
Labels: ui-kit, infra, aesthetics
Depends On: ASR-201
ASR-205: Refactor Base <Button> Component

Story: As a Dev, I want the base <Button> component (@/components/ui/Button) refactored internally to use @theme variables, apply base .btn styles, variants, states (hover/active/disabled), and effects (shimmer, subtle ancient glow on focus/hover) defined in global.css.
Sub-tasks: [code] Update component TSX/CSS; [code] Map props to CSS classes/variables; [code] Implement glow effect using theme vars; [test] Update unit tests; [test] Add visual regression tests (Chromatic/Percy); [a11y] Verify focus state, keyboard op; [docs] Update Storybook stories.
SP: 4
Labels: ui-kit, refactor, a11y, aesthetics
Depends On: ASR-201
ASR-206: Refactor Base <Input> Component

Story: As a Dev, I want the base <Input> component (@/components/ui/Input) refactored internally to use @theme variables and apply .input-field styles (background, border, padding, focus ring with subtle ancient glow, inset shadow) defined in global.css. Consider ornamental placeholder styles if applicable.
Sub-tasks: [code] Update component TSX/CSS; [code] Style focus ring glow; [test] Update unit tests; [test] Add visual regression tests (Chromatic/Percy); [a11y] Verify label association, focus state styling; [docs] Update Storybook stories.
SP: 3
Labels: ui-kit, refactor, a11y, aesthetics
Depends On: ASR-201
ASR-207: Refactor Base <Panel> Component & Add Ornate Variant

Story: As a Dev, I want the base <Panel> component (@/components/panels/Panel) refactored internally to use @theme variables, apply base .panel styles (background, border, padding, radius) from global.css, and support an optional .panel--ornate variant that applies a subtle texture (--texture-runic-subtle) or highlight glow.
Sub-tasks: [code] Update component TSX/CSS; [code] Add variant prop (e.g., ornate); [code] Apply base styles; [code] Apply conditional texture/glow styles for ornate variant using CSS vars; [test] Basic render test + variant test; [test] Add visual regression tests (Chromatic/Percy); [docs] Update Storybook.
SP: 3 (Increased for variant & visual tests)
Labels: ui-kit, refactor, aesthetics
Depends On: ASR-201, ASR-NEW-101
ASR-204: Build/Refactor <AsrayaAvatar> Component

Story: As a Dev, I want a stateless <AsrayaAvatar> component displaying images or fallbacks (using theme gradients), supporting sizes, stacking context, using @theme variables, and optionally displaying a faint swirling/rotating glow behind the avatar (respecting reduced motion).
Sub-tasks: [code] Implement/update component TSX; [code] Handle image/fallback logic & theme gradients; [code] Add optional glow prop & subtle GSAP animation (conditional on prefers-reduced-motion); [test] Unit tests (incl. glow toggle); [test] Add visual regression tests (Chromatic/Percy); [docs] Storybook stories.
SP: 4 (Increased for animation & visual tests)
Labels: ui-kit, aesthetics, animation
Depends On: ASR-201, ASR-214 (Motion Tokens - Needs to be done early in Sprint 2 or late Sprint 1)
Sprint 2: Core Layout, List Refactor & Motion Foundation
(Goal: Implement responsive layouts, refactor chat list using aligned components & container queries, establish motion system)

ASR-214: Establish Motion Tokens & GSAP Setup

Story: As a Dev, I want a motionTokens.ts file exporting durations, easings, and potentially predefined GSAP animation configurations (e.g., subtle fades, ornamental swirls) derived from @theme variables, along with base GSAP setup (including Premium plugins if licensed/needed).
Sub-tasks: [code] Create motionTokens.ts; [code] Export durations/easings from @theme; [code] Define reusable GSAP tween/timeline functions (e.g., fadeIn, subtleSwirl); [code] Setup GSAP core & potentially plugins (ScrollTrigger, Flip); [docs] Document token usage ("Motion Bible" initial draft).
SP: 3
Labels: infra, animation, gsap, dx
Depends On: ASR-201
ASR-210: Implement DesktopLayout Component

Story: As a User on desktop, I want a 3-column layout structure (Channels, Conversations, Context) styled according to global.css, using CSS Grid/Flexbox and theme spacing, potentially with subtle background shade variations between columns.
Sub-tasks: [code] Create DesktopLayout.tsx; [code] Implement layout using @theme spacing/variables; [code] Define slots for zones; [code] Apply subtle background variations using color-mix() or theme variables; [test] Basic render test; [code] Define --sidebar-x with @property if planning resizable handles animation.
SP: 3
Labels: feat/chat, layout
Depends On: ASR-201
ASR-211: Implement MobileLayout Component

Story: As a User on mobile, I want a bottom-tab based navigation structure styled according to global.css, allowing easy switching between main views.
Sub-tasks: [code] Create MobileLayout.tsx; [code] Implement Bottom Tab structure using theme variables/styles/icons; [code] Define view area; [code] Define relevant CSS vars with @property for potential ornamental opening transition (future); [test] Basic render test.
SP: 3
Labels: feat/chat, layout, mobile
Depends On: ASR-201, ASR-208
ASR-212: Refactor ConversationListPanel Structure & Components

Story: As a Dev, I want ConversationListPanel updated to use the refactored base components (<Input>, <Button>, <Panel>), apply theme styles (.custom-scrollbar, display font for header, theme variables), use container queries for width toggling, receive ChatListItemShape[] props, and potentially feature subtle etched dividers.
Sub-tasks: [code] Replace legacy components with refactored ones; [code] Apply theme styles (incl. header font, divider style); [code] Implement container queries; [code] Update prop types/internal mapping; [test] Update unit tests; [a11y] Verify scrollable list accessibility; [planning] Note dependency on ANI-310 (GSAP Flip).
SP: 5
Labels: feat/chat, refactor, ui-kit, mobile, aesthetics
Depends On: ASR-205, ASR-206, ASR-207, ASR-NEW-101, ASR-213
ASR-213: Refactor ChatListItem

Story: As a Dev, I want ChatListItem updated internally to use the refactored <AsrayaAvatar>, consume ChatListItemShape, and apply Halo token styling (@theme variables for text, background, spacing, active/hover states with subtle glow/texture highlight) from global.css.
Sub-tasks: [code] Replace legacy avatar with <AsrayaAvatar>; [code] Update props/logic; [code] Apply @theme styles including enhanced hover/active states; [test] Update unit tests; [docs] Update Storybook.
SP: 3
Labels: feat/chat, refactor, ui-kit, aesthetics
Depends On: ASR-204
ASR-NEW-301: Implement Resizable Panel Handles

Story: As a Dev, I want the resize handles (e.g., PanelResizeHandle) between columns in the Desktop Layout to use theme styling and exhibit a subtle glow effect on hover/drag, consistent with the ancient-future aesthetic.
Sub-tasks: [code] Integrate/style react-resizable-panels handles; [code] Apply theme variables for look; [code] Add hover/active glow effect using CSS vars/classes; [test] Verify functionality & styling.
SP: 2
Labels: feat/chat, layout, ui-kit, aesthetics
Depends On: ASR-210
Sprint 3: Realtime Basics & Presence v1 + Initial Animations
(Goal: Connect to realtime, show basic online status visually with animation, implement first GSAP animations)

ASR-220: Implement useRealtimeUpdates Hook Skeleton (Same as Playbook v5)

SP: 5, Labels: infra, realtime, hook
ASR-221: Define PresenceSlice & TypingSlice (Same as Playbook v5)

SP: 3, Labels: state, infra
ASR-222: Subscribe to Presence Channel (Same as Playbook v5)

SP: 3, Labels: infra, realtime, hook, Depends On: ASR-220
ASR-223: Implement PresenceSlice Actions (Same as Playbook v5)

SP: 3, Labels: state, realtime, Depends On: ASR-221, ASR-222
ASR-224: Add Online Indicator to ChatListItem

Story: As a User, I want to see a visual indicator (styled using theme success color) on list items for online users, with a subtle fade/pulse animation using GSAP & motion tokens, respecting reduced motion.
Sub-tasks: [code] Add online status logic/prop to ChatListItem; [code] Select presence state in parent and pass prop; [ui] Style indicator using theme variables; [code] Animate indicator fade/pulse using GSAP (motionTokens.ts), respecting prefers-reduced-motion.
SP: 3
Labels: feat/chat, ui, animation, gsap
Depends On: ASR-213, ASR-223, ASR-214
ANI-NEW-301: Subtle 3D/Parallax Panel Hover

Story: As a Dev, I want Panels (or specific panel types like Agent selection) to have an optional, very subtle 3D tilt effect on hover (~2-3deg) using CSS transform-style: preserve-3d or GSAP, respecting reduced motion.
Sub-tasks: [code] Add optional prop to <Panel> or create a wrapper; [code] Apply subtle CSS 3D transform on hover OR use GSAP quickSetter; [perf] Ensure will-change: transform is used judiciously; [a11y] Ensure effect disables with prefers-reduced-motion.
SP: 2
Labels: animation, ui-kit, aesthetics, gsap (optional)
Depends On: ASR-207, ASR-214
Sprints 4-8+ Planning Notes & Potential Future Stories:
Agent Theming:
TM-401: Implement Agent Theme Switching: Apply .theme-<agentName> classes dynamically to main layout containers based on active context. Ensure global.css defines theme overrides (colors, glows, potentially subtle background patterns) for each agent theme.
TM-402: Agent Color Highlights: Use agent-specific color variables (--agent-color-primary, etc.) for subtle highlights like panel header underglows or active item borders.
Core Chat Features:
FEAT-410: Context Panel Implementation: Structure and style the context panel (e.g., thread view, user info) using refactored components and theme variables/styles.
FEAT-420: Composer Refactor/Implementation: Build/refine the message input component (InputBar) using base primitives, supporting attachments, markdown preview, potentially with ornamental styling touches.
FEAT-430: Message Bubble Styling: Style message bubbles, timestamps, code blocks according to the "Aethelstone Codex".
FEAT-510: Implement Typing Indicators: Connect TypingSlice to Realtime hook and display typing indicators in the UI.
Animation & Polish (GSAP):
ANI-310: List FLIP Animation: Use GSAP Flip for seamless list reordering / new item insertions in ConversationListPanel. Add ephemeral "magical spark" or "glow wave" effect on insertion (optional, respects reduced motion).
ANI-NEW-401: Ornamental Mobile Drawer Transition: Animate the opening/closing of the mobile sidebar/drawer using a sliding arc or futuristic "iris" effect with GSAP, degrading gracefully for reduced motion.
ANI-320: Context Panel Reveal/Pin: Use GSAP ScrollTrigger to animate/pin the Context Panel based on scroll position.
ANI-330: Silky Scroll (Desktop): Implement GSAP ScrollSmoother for native-feeling momentum scrolling on desktop lists (conditional on hover capability).
PF-811: GSAP LagSmoothing & Frame Throttle: Enable gsap.ticker.lagSmoothing() and throttle ScrollTrigger refresh.
DX-340: GSAP DevTools Integration: Integrate GSAP DevTools (non-production).
Performance & Offline:
PF-501: List Virtualization: Implement virtualization (e.g., react-window, tanstack-virtual) for Conversation & Message Lists.
PF-601: PWA Basics & Caching: Implement basic PWA manifest, service worker, and caching strategy (app shell, static assets).
PF-602: Offline Data Caching: Strategy for caching recent messages/conversations (e.g., IndexedDB).
PF-701: Bundle Size Analysis & Optimization: Use tools like webpack-bundle-analyzer to identify and optimize large dependencies.
Accessibility:
A11Y-360: Global Reduced Motion Hook/Context: Ensure a robust way to check prefers-reduced-motion globally and disable/simplify animations consistently.
A11Y-701: Full A11y Audit & Remediation: Dedicated pass using screen readers, keyboard navigation, and tools like axe-core before major releases.